<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FinTrack / Command</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #FAFAFA; color: #171717; }
    h1, h2, h3, h4, .font-display { font-family: 'Space Grotesk', sans-serif; }
    
    /* Thin Scrollbar for internal lists */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #d4d4d4; border-radius: 4px; }
    
    .tracking-tightest { letter-spacing: -0.04em; }
    
    /* Filter Button State */
    .filter-btn.active { background-color: black; color: white; border-color: black; }
  </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-neutral-50">

  <header class="flex justify-between items-center px-6 py-4 bg-white border-b border-neutral-200 shrink-0 z-10">
    <div class="flex items-center gap-3">
      <h1 class="text-2xl font-bold tracking-tightest uppercase">FinTrack.</h1>
      <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-neutral-100 text-neutral-500 uppercase tracking-widest">Dashboard v5</span>
    </div>
    <div class="flex gap-2">
      <button onclick="exportToCSV()" class="text-xs font-bold uppercase tracking-wide hover:underline">Export</button>
      <span class="text-neutral-300">|</span>
      <button onclick="clearAllData()" class="text-xs font-bold uppercase tracking-wide text-red-500 hover:underline">Reset</button>
    </div>
  </header>

  <main class="flex-1 grid grid-cols-1 lg:grid-cols-3 divide-y lg:divide-y-0 lg:divide-x divide-neutral-200 overflow-hidden">

    <section class="flex flex-col h-full bg-white">
      <div class="p-6 border-b border-neutral-100 shrink-0">
        <h2 class="text-xl font-bold flex items-center gap-2 mb-4">
          <span class="w-2 h-2 bg-green-500 rounded-full"></span> Income
        </h2>
        <div class="flex border border-neutral-200 focus-within:border-black transition-all">
          <input id="walletName" class="flex-1 p-2.5 text-sm bg-white outline-none font-medium placeholder-neutral-400" type="text" placeholder="Source (e.g. Salary)">
          <div class="w-px bg-neutral-200"></div>
          <input id="walletAmount" class="w-20 p-2.5 text-sm bg-white outline-none font-mono text-right placeholder-neutral-400" type="number" placeholder="0">
          <button onclick="addWallet()" class="bg-black text-white px-3 font-bold text-xs uppercase hover:bg-neutral-800 transition-colors">Add</button>
        </div>
      </div>
      
      <div id="walletList" class="flex-1 overflow-y-auto p-6 space-y-0">
        </div>

      <div class="p-4 bg-neutral-50 border-t border-neutral-200 shrink-0 flex justify-between items-center">
        <span class="text-xs font-bold text-neutral-400 uppercase tracking-widest">Total Income</span>
        <span class="text-lg font-mono font-bold text-green-600">+<span id="summaryTotal">0.00</span></span>
      </div>
    </section>


    <section class="flex flex-col h-full bg-white relative z-0">
      <div class="p-6 border-b border-neutral-100 shrink-0">
        <h2 class="text-xl font-bold flex items-center gap-2 mb-4">
          <span class="w-2 h-2 bg-red-500 rounded-full"></span> Expenses
        </h2>

        <div class="flex gap-2 overflow-x-auto pb-3 mb-1 no-scrollbar">
          <button onclick="setFilter('All')" class="filter-btn active border border-neutral-200 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide transition-colors whitespace-nowrap">All</button>
          <button onclick="setFilter('Food')" class="filter-btn border border-neutral-200 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide hover:border-black transition-colors whitespace-nowrap">Food</button>
          <button onclick="setFilter('Transport')" class="filter-btn border border-neutral-200 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide hover:border-black transition-colors whitespace-nowrap">Transport</button>
          <button onclick="setFilter('Utilities')" class="filter-btn border border-neutral-200 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide hover:border-black transition-colors whitespace-nowrap">Utilities</button>
        </div>

        <div class="border border-neutral-200 focus-within:border-black transition-all">
          <div class="flex border-b border-neutral-100">
            <input id="expenseName" class="flex-1 p-2.5 text-sm bg-white outline-none font-medium placeholder-neutral-400" type="text" placeholder="Description">
            <div class="w-px bg-neutral-100"></div>
            <select id="expenseCategory" class="p-2.5 bg-white outline-none font-medium text-xs text-neutral-500 cursor-pointer hover:text-black">
              <option value="Food">Food</option>
              <option value="Transport">Transport</option>
              <option value="Utilities">Utilities</option>
              <option value="Entertainment">Fun</option>
              <option value="Shopping">Shop</option>
              <option value="Others">Other</option>
            </select>
          </div>
          <div class="flex">
            <input id="expenseAmount" class="flex-1 p-2.5 text-sm bg-white outline-none font-mono placeholder-neutral-400" type="number" placeholder="0.00">
            <button onclick="addExpense()" class="bg-black text-white px-4 font-bold text-xs uppercase hover:bg-neutral-800 transition-colors">Add</button>
          </div>
        </div>
      </div>

      <div id="expenseList" class="flex-1 overflow-y-auto p-6 space-y-0">
        </div>

      <div class="p-4 bg-neutral-50 border-t border-neutral-200 shrink-0 flex justify-between items-center">
        <span class="text-xs font-bold text-neutral-400 uppercase tracking-widest">Total Expense</span>
        <span class="text-lg font-mono font-bold text-red-600">-<span id="summaryExpenses">0.00</span></span>
      </div>
    </section>


    <section class="flex flex-col h-full bg-neutral-50 overflow-y-auto">
      <div class="p-8 space-y-8">
        
        <div>
          <span class="text-xs font-bold text-neutral-400 uppercase tracking-widest">Net Balance</span>
          <h2 class="text-5xl lg:text-6xl font-bold tracking-tighter text-black mt-2 leading-none">
            <span class="text-2xl align-top font-medium text-neutral-400">â‚±</span><span id="summaryBalance">0.00</span>
          </h2>
        </div>

        <div class="bg-white p-6 border border-neutral-200">
          <div class="flex justify-between items-end mb-3">
            <label class="text-sm font-bold" id="budgetStatusText">Monthly Budget</label>
            <div class="flex items-baseline gap-1 border-b border-neutral-200 hover:border-black transition-colors">
              <input type="number" id="budgetLimitInput" onchange="updateBudgetLimit()" class="w-20 text-right font-mono text-sm bg-transparent outline-none" placeholder="Set Limit">
            </div>
          </div>
          <div class="w-full h-2 bg-neutral-100 mb-2">
            <div id="budgetProgressBar" class="h-full bg-black transition-all duration-500" style="width: 0%"></div>
          </div>
          <div class="flex justify-between text-[10px] font-mono text-neutral-400 uppercase">
            <span>0%</span>
            <span>50%</span>
            <span>100%</span>
          </div>
        </div>

        <div class="bg-white p-6 border border-neutral-200">
          <span class="text-xs font-bold text-neutral-400 uppercase tracking-widest mb-4 block">Spending Distribution</span>
          <div class="h-48 w-full flex items-center justify-center relative">
            <canvas id="expenseChart"></canvas>
            <div id="chartEmptyState" class="absolute inset-0 flex items-center justify-center text-neutral-300 font-display text-xl font-bold uppercase pointer-events-none">No Data</div>
          </div>
        </div>

      </div>
      
      <div class="mt-auto p-6 text-center">
         <p class="text-[10px] text-neutral-400 uppercase tracking-widest">FinTrack System</p>
      </div>
    </section>

  </main>

  <script>
    const categoryConfig = {
      'Food': '#171717', 'Transport': '#525252', 'Utilities': '#2563eb',
      'Entertainment': '#9333ea', 'Shopping': '#db2777', 'Others': '#d4d4d4'
    };
    
    let wallets = [], expenses = [], budgetLimit = 0, myChart = null, currentFilter = 'All';

    window.onload = function() { loadData(); };

    function saveData() {
      localStorage.setItem('wallets', JSON.stringify(wallets));
      localStorage.setItem('expenses', JSON.stringify(expenses));
      localStorage.setItem('budgetLimit', budgetLimit.toString());
    }

    function loadData() {
      const w = localStorage.getItem('wallets');
      const e = localStorage.getItem('expenses');
      const l = localStorage.getItem('budgetLimit');
      if (w) wallets = JSON.parse(w);
      if (e) expenses = JSON.parse(e);
      if (l) { budgetLimit = parseFloat(l); document.getElementById('budgetLimitInput').value = budgetLimit; }
      updateWalletDisplay(); updateExpenseDisplay();
    }

    function clearAllData() {
      if(confirm('Clear dashboard?')) {
        wallets = []; expenses = []; budgetLimit = 0;
        document.getElementById('budgetLimitInput').value = '';
        saveData(); updateWalletDisplay(); updateExpenseDisplay();
      }
    }

    const formatCurrency = (num) => num.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const getFormattedDate = () => new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

    function exportToCSV() {
      if (!expenses.length && !wallets.length) return alert("No data.");
      let csv = "data:text/csv;charset=utf-8,Type,Name,Category,Amount,Date\n";
      wallets.forEach(r => csv += `Income,${r.name},Source,${r.amount},${r.date}\n`);
      expenses.forEach(r => csv += `Expense,${r.name},${r.category},${r.amount},${r.date}\n`);
      const link = document.createElement("a");
      link.setAttribute("href", encodeURI(csv));
      link.setAttribute("download", "fintrack_export.csv");
      document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }

    function updateBudgetLimit() {
      budgetLimit = parseFloat(document.getElementById('budgetLimitInput').value) || 0;
      saveData(); updateProgressBar();
    }

    function updateProgressBar() {
      const total = expenses.reduce((acc, e) => acc + e.amount, 0);
      const bar = document.getElementById('budgetProgressBar');
      const label = document.getElementById('budgetStatusText');
      
      if (budgetLimit === 0) { bar.style.width = '0%'; label.textContent = "Monthly Budget"; return; }
      
      const pct = Math.min((total / budgetLimit) * 100, 100);
      bar.style.width = pct + '%';
      
      if (total > budgetLimit) { bar.style.backgroundColor = '#dc2626'; label.innerHTML = `Over Budget <span class="text-red-600">(${pct.toFixed(0)}%)</span>`; }
      else if (pct > 80) { bar.style.backgroundColor = '#f59e0b'; label.innerHTML = `Careful <span class="text-amber-600">(${pct.toFixed(0)}%)</span>`; }
      else { bar.style.backgroundColor = '#000000'; label.innerHTML = `On Track <span class="text-green-600">(${pct.toFixed(0)}%)</span>`; }
    }

    function updateChart() {
      const ctx = document.getElementById('expenseChart').getContext('2d');
      if (expenses.length === 0) {
        if (myChart) myChart.destroy();
        document.getElementById('chartEmptyState').classList.remove('hidden'); return;
      }
      document.getElementById('chartEmptyState').classList.add('hidden');
      
      const totals = {};
      expenses.forEach(exp => {
        if (!totals[exp.category]) totals[exp.category] = 0;
        totals[exp.category] += exp.amount;
      });

      if (myChart) myChart.destroy();
      myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(totals),
          datasets: [{
            data: Object.values(totals),
            backgroundColor: Object.keys(totals).map(cat => categoryConfig[cat] || '#d4d4d4'),
            borderWidth: 0
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, cutout: '70%' }
      });
    }

    function setFilter(cat) {
      currentFilter = cat;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === cat);
      });
      updateExpenseDisplay();
    }

    function updateWalletDisplay() {
      const list = document.getElementById('walletList');
      let total = 0;
      list.innerHTML = '';
      if (!wallets.length) list.innerHTML = '<div class="text-neutral-300 text-xs font-mono uppercase text-center py-10">No Income Data</div>';
      else {
        wallets.slice().reverse().forEach((w, i) => {
          total += w.amount;
          list.innerHTML += `
            <div class="group flex justify-between items-center py-3 border-b border-neutral-100 hover:bg-neutral-50 px-2 -mx-2 transition">
              <div><h4 class="font-bold text-sm">${w.name}</h4><p class="text-[10px] text-neutral-400 font-mono uppercase">${w.date}</p></div>
              <div class="flex items-center gap-2"><span class="font-mono text-sm text-green-600 font-bold">+${formatCurrency(w.amount)}</span><button onclick="deleteWallet(${wallets.length-1-i})" class="text-[10px] uppercase font-bold text-neutral-300 hover:text-black opacity-0 group-hover:opacity-100">Del</button></div>
            </div>`;
        });
      }
      document.getElementById('summaryTotal').textContent = formatCurrency(total);
      updateBalance();
    }

    function updateExpenseDisplay() {
      const list = document.getElementById('expenseList');
      let total = 0;
      list.innerHTML = '';
      const filtered = currentFilter === 'All' ? expenses : expenses.filter(e => e.category === currentFilter);
      
      if (!filtered.length) list.innerHTML = '<div class="text-neutral-300 text-xs font-mono uppercase text-center py-10">No Expenses</div>';
      else {
        filtered.slice().reverse().forEach((e) => {
          const originalIndex = expenses.indexOf(e);
          total += e.amount;
          const color = categoryConfig[e.category] || '#d4d4d4';
          list.innerHTML += `
            <div class="group flex justify-between items-center py-3 border-b border-neutral-100 hover:bg-neutral-50 px-2 -mx-2 transition">
              <div class="flex items-center gap-3">
                <div class="w-1.5 h-1.5 rounded-full bg-black shrink-0" style="background-color: ${color}"></div>
                <div><h4 class="font-bold text-sm">${e.name}</h4><div class="flex gap-2"><span class="text-[10px] text-neutral-400 font-bold uppercase">${e.category}</span><span class="text-[10px] text-neutral-300 font-mono">${e.date}</span></div></div>
              </div>
              <div class="flex items-center gap-2"><span class="font-mono text-sm font-medium">${formatCurrency(e.amount)}</span><button onclick="deleteExpense(${originalIndex})" class="text-[10px] uppercase font-bold text-neutral-300 hover:text-black opacity-0 group-hover:opacity-100">Del</button></div>
            </div>`;
        });
      }
      const allTotal = expenses.reduce((a,b)=>a+b.amount,0);
      document.getElementById('summaryExpenses').textContent = formatCurrency(allTotal);
      updateBalance(); updateChart(); updateProgressBar();
    }

    function addWallet() {
      const n = document.getElementById('walletName').value.trim();
      const a = parseFloat(document.getElementById('walletAmount').value);
      if (n && a > 0) { wallets.push({ name: n, amount: a, date: getFormattedDate() }); document.getElementById('walletName').value=''; document.getElementById('walletAmount').value=''; saveData(); updateWalletDisplay(); }
    }
    function deleteWallet(i) { wallets.splice(i, 1); saveData(); updateWalletDisplay(); }

    function addExpense() {
      const n = document.getElementById('expenseName').value.trim();
      const c = document.getElementById('expenseCategory').value;
      const a = parseFloat(document.getElementById('expenseAmount').value);
      if (n && a > 0) { expenses.push({ name: n, category: c, amount: a, date: getFormattedDate() }); document.getElementById('expenseName').value=''; document.getElementById('expenseAmount').value=''; saveData(); updateExpenseDisplay(); }
    }
    function deleteExpense(i) { expenses.splice(i, 1); saveData(); updateExpenseDisplay(); }

    function updateBalance() {
      const t = wallets.reduce((a, w) => a + w.amount, 0);
      const e = expenses.reduce((a, x) => a + x.amount, 0);
      document.getElementById('summaryBalance').textContent = formatCurrency(t - e);
    }
  </script>
</body>
</html>